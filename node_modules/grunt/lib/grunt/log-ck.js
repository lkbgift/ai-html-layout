/*
 * grunt
 * http://gruntjs.com/
 *
 * Copyright (c) 2012 "Cowboy" Ben Alman
 * Licensed under the MIT license.
 * https://github.com/gruntjs/grunt/blob/master/LICENSE-MIT
 */"use strict";function markup(e){e=e||"";e=e.replace(/(\s|^)_(\S|\S[\s\S]+?\S)_(?=[\s,.!?]|$)/g,"$1"+"$2".underline);e=e.replace(/(\s|^)\*(\S|\S[\s\S]+?\S)\*(?=[\s,.!?]|$)/g,"$1"+"$2".bold);return e}var grunt=require("../grunt"),util=require("util"),log=module.exports={},colors=require("colors");log.initColors=function(){var e=grunt.util;if(grunt.option("no-color")){colors.mode="none";e.hooker.hook(console,"log",function(){var t=e.toArray(arguments);return e.hooker.filter(this,t.map(function(t){return e.kindOf(t)==="string"?colors.stripColors(t):t}))})}};var suppressOutput;log.muted=!1;var hasLogged;log.write=function(e){if(!log.muted&&!suppressOutput){hasLogged=!0;grunt.option("no-color")&&(e=colors.stripColors(e));process.stdout.write(markup(e))}return this};log.writeln=function(e){this.write((e||"")+"\n");return this};log.warn=function(e){return e?this.writeln(">> ".red+grunt.util._.trim(e).replace(/\n/g,"\n>> ".red)):this.writeln("ERROR".red)};log.error=function(e){if(e){grunt.fail.errorcount++;return this.writeln(">> ".red+grunt.util._.trim(e).replace(/\n/g,"\n>> ".red))}return this.writeln("ERROR".red)};log.ok=function(e){return e?this.writeln(">> ".green+grunt.util._.trim(e).replace(/\n/g,"\n>> ".green)):this.writeln("OK".green)};log.errorlns=function(e){return this.error(log.wraptext(77,e))};log.oklns=function(e){return this.ok(log.wraptext(77,e))};log.success=function(e){return this.writeln(e.green)};log.fail=function(e){return this.writeln(e.red)};log.header=function(e){hasLogged&&this.writeln();return this.writeln(e.underline)};log.subhead=function(e){hasLogged&&this.writeln();return this.writeln(e.bold)};log.debug=function(){grunt.option("debug")&&this.writeln(("[D] "+util.format.apply(this,arguments)).magenta);return this};log.writetableln=function(e,t){return this.writeln(this.table(e,t))};log.writelns=function(e){return this.writeln(this.wraptext(80,e))};log.writeflags=function(e,t){var n;Array.isArray(e)?n=log.wordlist(e):typeof e=="object"&&e&&(n=log.wordlist(Object.keys(e).map(function(t){var n=e[t];return t+(n===!0?"":"="+JSON.stringify(n))})));return this.writeln((t||"Flags")+": "+(n||"(none)".cyan))};log.verbose={};log.notverbose={};Object.keys(log).filter(function(e){return typeof log[e]=="function"}).forEach(function(e){log.verbose[e]=function(){suppressOutput=!grunt.option("verbose");log[e].apply(this,arguments);suppressOutput=!1;return this};log.notverbose[e]=function(){suppressOutput=grunt.option("verbose");log[e].apply(this,arguments);suppressOutput=!1;return this}});log.verbose.or=log.notverbose;log.notverbose.or=log.verbose;log.wordlist=function(e,t){t=grunt.util._.defaults(t||{},{separator:", ",color:"cyan"});return e.map(function(e){return t.color?String(e)[t.color]:e}).join(t.separator)};log.uncolor=function(e){return e.replace(/\x1B\[\d+m/g,"")};log.wraptext=function(e,t){var n=[],r,i,s,o=[],u=0;while(r=t.match(/(?:(\x1B\[\d+m)|\n|(.))([\s\S]*)/)){t=r[3];if(r[1]){i=r[1];o.push(r[1]);continue}if(r[2]){u===0&&i&&o.push(i);o.push(r[2]);u++;if(u<=e||r[2]===" ")continue;s=o.lastIndexOf(" ");t=o.slice(s===-1?s:s+1).join("")+t;o=o.slice(0,s)}n.push(o.join(""));o=[];u=0}n.push(o.join(""));return n.join("\n")};log.table=function(e,t){var n=[];e.forEach(function(e,r){var i=log.wraptext(e,t[r]).split("\n");i.forEach(function(e,t){var i=n[t];i||(i=n[t]=[]);i[r]=e})});var r=[];n.forEach(function(t){var n="",i;for(var s=0;s<t.length;s++){i=t[s]||"";n+=i;var o=e[s]-log.uncolor(i).length;o>0&&(n+=grunt.util.repeat(o," "))}r.push(n)});return r.join("\n")};